<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classroom Seating Chart</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        .container {
            outline: 2px solid red;
            position: relative;
            max-width: 1200px;
            margin: 20px auto;
            text-align: center;
        }

        .seat-label {
            outline: 1px dashed blue;
            position: absolute;
            border: 2px solid yellow; /* Bright yellow border for visibility */
            background-color: rgba(255, 255, 255, 0.8); /* Semi-transparent background */
            color: black; /* Text color */
            padding: 5px; /* Adjusted padding */
            font-size: 14px; /* Adjusted font size */
            text-align: center;
            transform: translate(-50%, -50%); /* Center text within rectangle */
            width: calc(60px * 1.2); /* Increase width by 20% */
            height: calc(30px * 1.2); /* Increase height by 20% */
        }

        .name-input {
            width: calc(100% - 10px); /* Full width minus padding */
            margin-top: 25px; /* Increased space between seat ID and Name input */
        }

        .name-display {
            width: calc(100% - 10px);
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid #ccc;
            padding: 5px;
            text-overflow: ellipsis; /* Cut off long names with ellipsis */
            overflow: hidden; /* Hide overflow text */
            white-space: nowrap; /* Prevent wrapping */
        }

        .overlay {
            display: none; /* Hidden by default */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent overlay */
        }

        #popup {
            display: none; /* Hidden by default */
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 15px;
            border-radius: 25px;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
        }

        #preview-container {
            width: 200px;
            height: 200px;
            border: 2px solid #ccc;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        #preview {
            width: 100%;
            height: 100%;
            object-fit: cover; 
        }

        .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 20px;
            color: red;
            cursor: pointer; 
        }
        
        .button {
          background-color: #ffffff;
          border: none;
          color: white;
          padding: 16px 32px;
          text-align: center;
          text-decoration: none;
          display: inline-block;
          font-size: 16px;
          margin-top :10px; 
          transition-duration :0.4s; 
          cursor :pointer; 
        }
        
        .button5 {
          background-color :white; 
          color :black; 
          border :2px solid #555555; 
          border-radius :5px; 
        }
        
        .button5:hover {
          background-color :#555555; 
          color :white; 
        }
        
    </style>
</head>
<body>
    <div class="container">
        <!-- Classroom Image -->
        <img src="classroom_images/RM303_Image_of_whole_classroom.png" usemap="#image-map" alt="Classroom Seating Chart">
        <!-- Dynamic Seat Labels -->
        <div id="seats"></div>

    </div>

    <!-- Popup for Profile Upload -->
    <div class="overlay" id="overlay" onclick="closePopup()"></div>
    <div id="popup">
        <h2 id="seat-title" style="font-family:Ariel;font-size :20px;color :rgb(32,32,32);text-align:center;"></h2>
        
        <input type="file" id="imageUpload" accept="image/*">
        
        <div id="preview-container">
           <img id="preview" alt="" class="default">
           <span id="removeButton" class="remove-image" onclick="removeImage()">x</span>
       </div>
       
       <div id="additionalInfo">
           <label for="name">Name:</label><br>
           <input type="text" id="name" maxlength="20" name="name"><br><br>
           
           <label for="bio">Questions and Answers:</label><br>
           <textarea style="resize:none" id="bio" name="bio" rows="4" cols="50"></textarea><br><br>
           
           <button class="button button5" onclick="saveChanges()" style="display:block;margin:auto;">Save</button>
       </div>
   </div>

   <script>
       const popup = document.getElementById('popup');
       const overlay = document.getElementById('overlay');
       const imageUpload = document.getElementById('imageUpload');
       const preview = document.getElementById('preview');
       const nameInput = document.getElementById('name');
       const bioInput = document.getElementById('bio');
       const removeButton = document.getElementById('removeButton');
       const seatTitle = document.getElementById('seat-title');

       let currentSeat = null;

       // Define seat positions and IDs
       const seats = [
         { id:'1A1', left:'145px', top:'250px' },
         { id:'1A2', left:'260px', top:'250px' },
         { id:'1A3', left:'385px', top:'250px' },
         { id:'1B1', left:'805px', top:'240.5px' },
         { id:'1B2', left:'960px', top:'234.5px' },
         { id:'1B3', left:'1077.5px', top:'226px' },
         { id:'2B1', left:'748px', top:'149px'},
         { id:'2B2', left:'849.5px', top:'145px'},
         { id:'2B3', left:'955.5px', top:'140px'},
         { id:'2B4', left:'1060.5px', top:'135.5px'},
         { id:'2A1', left:'180.5px', top:'165px'},
         { id:'2A2', left:'290.5px', top:'160.5px'},
         { id:'2A3', left:'400px', top:'160.5px'},
         { id:'2A4', left:'500.5px', top:'160.5px'}
       ];

       // Will add more seats.

       // Function to create seat labels dynamically
       function createSeatLabels() {
           const seatsContainer = document.getElementById('seats');
           
           seats.forEach(seat => {
               const seatLabel = document.createElement('div');
               seatLabel.className = 'seat-label';
               seatLabel.style.left = seat.left;
               seatLabel.style.top = seat.top;

               // Display the seat ID
               seatLabel.textContent = seat.id;

               // Create a container for displaying the custom name
               const nameDisplayContainer = document.createElement('div');
               nameDisplayContainer.className = 'name-display';
               nameDisplayContainer.id = `name-display-${seat.id}`;
               nameDisplayContainer.textContent = "Name"; 
               nameDisplayContainer.style.fontFamily = "Verdana, sans-serif";
               nameDisplayContainer.style.fontSize = "12";
               nameDisplayContainer.style.fontWeight = "normal";
               nameDisplayContainer.style.color = "Black";
               nameDisplayContainer.style.opacity = "0.7";
               
               seatLabel.appendChild(nameDisplayContainer);
               
               seatLabel.onclick = (event) => openPopup(seat.id);

               seatsContainer.appendChild(seatLabel);
           });
       }

       function openPopup(seatId) {
           currentSeat = seatId;

           // Set the title to the selected seat ID
           seatTitle.textContent = `Seat ID: ${seatId}`;
           seatTitle.style.fontFamily = "Arial";
           seatTitle.style.fontSize = "20px";
           seatTitle.style.fontWeight = "bold";


           popup.style.display = 'block';
           overlay.style.display = 'block';


           preview.src = ""; // Reset preview
           removeButton.style.display = 'none';
           nameInput.value = ''; 
           bioInput.value = ''; 

           loadSavedData();
       }

       function loadSavedData() {
           const savedData = JSON.parse(localStorage.getItem(currentSeat)) || {};
           preview.src = savedData.profilePicture || "";
           nameInput.value = savedData.name || ""; 
           bioInput.value = savedData.bio || ""; 

           if (savedData.profilePicture) {
               removeButton.style.display = 'block'; // Show remove button if there's a picture
           } else {
               removeButton.style.display = 'none'; // Hide remove button if no picture
           }
       }

       function closePopup() {
           popup.style.display = 'none';
           overlay.style.display = 'none';
       }

       function saveChanges() {
           if (currentSeat) {
               const profileData = {
                   profilePicture : preview.src,
                   name : nameInput.value,
                   bio : bioInput.value
               };
               
               localStorage.setItem(currentSeat, JSON.stringify(profileData)); // Save data to local storage (Reminder: Change when using server)

               // Update the displayed name below the seat ID!
               const nameDisplayContainer = document.getElementById(`name-display-${currentSeat}`);
               nameDisplayContainer.textContent = profileData.name || "Name"; // Display custom name or default

               closePopup();
           }
       }

       imageUpload.addEventListener('change', function(event) {
           const file = event.target.files[0];

           if (file) {
               if (file.size > 3 * 1024 * 1024) { 
                   alert("File size exceeds 3MB.");
                   imageUpload.value = "";
                   return; 
               }
               
               const reader = new FileReader();
               
               reader.onload = function(e) {
                   preview.src = e.target.result; // Load image
                   removeButton.style.display = 'block'; // Show remove button
               };
               
               reader.readAsDataURL(file);
           }
       });

       function removeImage() {
           imageUpload.value = '';
           preview.src = ""; // Reset to empty src
           removeButton.style.display = 'none'; // Hide remove button

           if (currentSeat) {
               const profileData = JSON.parse(localStorage.getItem(currentSeat)) || {};
               profileData.profilePicture = ""; // Clear profile picture from saved data
               localStorage.setItem(currentSeat, JSON.stringify(profileData)); // !!!!!!!!!!Update local storage!!!!!!!!!!!
           }
       }
       createSeatLabels();
   </script>
</body>
</html>
